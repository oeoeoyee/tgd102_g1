<!DOCTYPE html>
<html lang="en">
<head>
    @@include('./layout/head.html', {
        "title" : "會員登入"
    })
    <script type="module" src="./js/login.js"></script>
</head>
<body>

    <div class="wrapper">
        <!-- header -->
        @@include('./layout/header.html')
        
        <!-- banner -->
        <div class="login_banner">
            <img src="./images/login_01.png" alt="">
        </div>

        <!-- 上面 -->
        <div class="login_top login_out">

            <h2>會員登入</h2>

            <form method="post" action="./index.html">
                <ul>
                    <!-- 電子信箱(帳號) -->
                    <li class="email">
                        <input type="email" placeholder="請輸入電子信箱" name="email" id="email">
                        <div class="error"></div>
                    </li>
                    <!-- 密碼 -->
                    <li class="pwd">
                        <input type="password" placeholder="密碼：英數混合，六至十二字" name="pwd" id="pwd">
                        <div class="error"></div>
                    </li>

                    <!-- 記住我/忘記密碼 -->
                    <li class="login_ckbox_out">
                        <div class="login_ckbox">
                            <label for="login_ckbox">
                                <input type="checkbox" id="login_ckbox" name="login_rem" value="記住我"><span>記住我</span>
                                
                            </label>
                        </div>
                        <a href="./forget.html">忘記密碼</a>
                    </li>   
                </ul>

                <!-- 按鈕 -->
                <div class="login_btn_out">
                    <input type="submit" id="login_btn" value="登入" class="btn_s_remind">
                    <a href="./signin.html" class="btn_s_default">註冊</a>
                </div>
                <div id="error"></div>
            </form>

        </div>

        <!-- 分隔線 -->
        <div class="login_line"></div>

        <!-- 其他登入 -->
        <div class="login_bottom">
            <h4>以其他方式登入</h4>
            <div class="login_icon">
                <a href="https://www.google.com.tw/?hl=zh_TW" alt=""><img src="./images/login_03_g.png" alt=""></a>
                <a href="https://zh-tw.facebook.com"><img src="./images/login_02_fb.png" alt=""></a>
            </div>
        </div>

        
        
        <!-- footer -->
        @@include('./layout/footer.html')
        
    </div>
    <!-- goTop 組件 -->
    @@include('./layout/goTop_component.html')
    <!-- goTop 組件 -->

    <script>
        (() => {
          // 取欄位值
          const useremail = document.querySelector("#email"); // 信箱 輸入欄
          const password = document.querySelector("#pwd"); // 密碼 輸入欄
          const errMsg = document.querySelector("#error"); // 錯誤訊息欄
  
          // 1. 綁定 id="login_btn" 加入登入功能
          //    先嘗試綁定 沒有綁定到就跳過 try catch
          try {
            // try 嘗試綁定 沒有就跳過
            document.getElementById("login_btn").addEventListener("click", () => {
              fetch("./php/login.php", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  useremail: useremail.value,
                  password: password.value,
                }),
              })
                .then((resp) => resp.json()) // 2. 取得回應後
                .then((body) => {
                  errMsg.textContent = "";
                  const { successful, message } = body;
                  if (successful) {
                    // true 就送 SESSION 到 使用者Cookie
                    const { MEMBER_ID, NAME, EMAIL } = body;
                    sessionStorage.setItem("MEMBER_ID", MEMBER_ID);
                    sessionStorage.setItem("NAME", NAME);
                    sessionStorage.setItem("EMAIL", EMAIL);
                    // 成功後 轉址 ? 會員中心
                    location = "./member_info.html";
                  } else {
                    // 失敗將收到的錯誤訊息寫進 HTML
                    errMsg.textContent = message;
                  }
                });
            });
          } catch (error) {
            // 跳過 (?)
          }
        })();
      </script>
</body>
</html>