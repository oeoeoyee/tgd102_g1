<!DOCTYPE html>
<html lang="en">
    <head>
        @@include('./layout/head.html', {
            "title" : "註冊會員"
        })
        <script type="module" src="./js/login.js"></script>
    </head>
    <body>
    
        <div class="wrapper">
            <!-- header -->
            @@include('./layout/header.html')
            
            <!-- banner -->
            <div class="login_banner">
                <img src="./images/login_01.png" alt="">
            </div>

            <!-- 上面 -->
            <div class="login_top signin_out">

                <h2>註冊</h2>

                <form method="post" action="./signin_succ.html">
                    <ul>
                        <!-- 姓名 -->
                        <li class="name">
                            <input type="text" placeholder="請輸入姓名" name="name" id="name">
                            <div class="error"></div>
                        </li>

                        <!-- 電子信箱(帳號) -->
                        <li class="email">
                            <input type="email" placeholder="請輸入電子信箱" name="email" id="email">
                            <div class="error"></div>
                        </li>

                        <!-- 手機 -->
                        <li class="phone">
                            <input type="tel" placeholder="請輸入手機號碼(範例：0912345678)" name="phone" id="phone">
                            <div class="error"></div>
                        </li>

                        <!-- 密碼 -->
                        <li class="pwd">
                            <input type="password" placeholder="密碼：英數混合，六至十二字" name="pwd" id="pwd">
                            <div class="error"></div>
                        </li>

                        <!-- 確認密碼 -->
                        <li class="pwdcomfirm">
                            <input type="password" placeholder="請再次輸入密碼" name="pwd" id="pwdcomfirm" onkeyup="check_password()">
                            <div class="error"></div>
                        </li>
                        <!-- 訂閱 -->
                        <li class="login_ckbox_out ckbox_center">
                            <div class="login_ckbox">
                                <label for="login_ckbox">
                                    <input type="checkbox" id="login_ckbox" name="signin_sub" value="訂閱電子報" class="signin_sub">
                                    <span>我想訂閱電子報</span>
                                </label>
                            </div>
                        </li>

                    </ul>

                    <!-- 按鈕 -->
                    <div class="login_btn_out signin_btn_out">
                        <input type="submit" value="註冊" class="btn_s_remind" id="signin_submit">
                    </div>
                    <div id="error"></div>
                </form>

            </div>
            
            
            <!-- footer -->
            @@include('./layout/footer.html')
            
    </div>
    <!-- goTop 組件 -->
    @@include('./layout/goTop_component.html')
    <!-- goTop 組件 -->

        <script>
            // ################################################################
            //            檢查會員是不是登入中 登入中就送去會員中心
            const AM_I_LOGIN = sessionStorage.getItem("MEMBER_ID");
            if (AM_I_LOGIN) {
                location.replace("./member_info.html");
            }
            // ################################################################

            const name = document.querySelector('#name');
            const email = document.querySelector('#email');
            const phone = document.querySelector('#phone');
            const pwd = document.querySelector('#pwd');
            const sub = document.querySelector('.signin_sub');
            const register = document.querySelector('#signin_submit');

            register.addEventListener('click', () => {

                let error_msg = "";

                // 姓名不為空
                if ($("#name").val() == "") {
                    error_msg = error_msg + "姓名、";
                }
                // if (!($("#name").val())) {
                //     error_msg = error_msg + "姓名、";
                // }

                // 信箱 反轉false送出錯誤警告
                if (!($("#email").val())) {
                    error_msg = error_msg + "Email錯誤、";
                }

                // 手機 反轉false送出錯誤警告
                if (!($("#phone").val())) {
                    error_msg = error_msg + "電話錯誤、";
                }

                // 密碼 反轉false送出錯誤警告
                if (!($("#pwd").val())) {
                    error_msg = error_msg + "密碼錯誤";
                }

                // 無誤後送出
                if (error_msg == "") {
                    fetch('./php/signin.php',{
                        method: 'POST',
                        headers: { 'Content-Type' : 'application/json' },
                        body: JSON.stringify({
                            name: name.value,
                            email: email.value,
                            phone: phone.value,
                            pwd: pwd.value,
                            sub: sub.checked,
                        })
                    })
                    .then(resp => resp.json(
                        // console.log(resp)
                    ))
                    .then(body => {
                        // console.log(body);
                        if (body.successful) {
                            // successful 就送 SESSION 到 使用者Cookie
                            const { MEMBER_ID } = body;
                            sessionStorage.setItem("MEMBER_ID", MEMBER_ID);

                            if(sessionStorage.getItem("MEMBER_ID")){
                                location = './signin_succ.html';
                            }
                        }
                    })
                    
                } else {
                    $("#error").html(error_msg + "，請再次確認");
                }

                
            })
        </script>

    
    </body>
</html>